<style> 
    p, table, figure, figcaption, h1, h2, h3, h4, h5, h6, .katex-display 
    {
        max-width:none;
        text-align: justify;
        margin: 15px 15px;
        text-wrap: pretty;
    }
</style>
# 2.2 - Top 10

## Análise dos TOP 10 maiores cantores e músicas mais ouvidas do Spotify.

Esta análise visa responder a seguinte questão:

**O conjunto das top 10 músicas e dos top 10 artistas varia muito se considerarmos apenas musicas lançadas no mesmo ano?**

Por se tratar de um comparativo de proporções de 10 itens, poderíamos escolher gráficos em formato de pizza ou de barras, ou até mesmo uma tabela, pois o intuito seria verificar se ocorreria grandes variações entre os eleitos em cada uma das duas categorias, levado-se em consideração o ano de lançamento da música.
<br><br>
Não obstante mostrar os top 10 eleitos, evidenciamos a oportunidade de mostrar o ranking de eleição dos artistas e das músicas, por isso optamos pelo gráfico em barras, uma vez que este proporciona uma melhor visualização entre proporções próximas no comparativo visual.

Diante do exposto, para responder a(s) questão(ões), desenvolvemos quatro histogramas e dividimo-los em dois grupos: <br>
1) a dos que analisam os cantores; e <br>
2) a dos que analisam as músicas.

Para o primeiro grupo, o dos cantores, temos o seguinte:

<div class="grid grid-cols-2">
    <div id="ex01" class="card">
        <h4>Top 10 maiores cantores com base no total de streams.</h4>
   <div style="width: 100%, margin-top: 15px;">
            ${ vl.render(ex01(divWidth-160)) }
        </div>
    </div>
    <div id="ex02" class="card">
        <h4>Top 10 maiores cantores com  músicas lançadas em 2023.</h4>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex02(divWidth-190)) }
        </div>
    </div>
</div>

Os histogramas acima denominados A1 e A2 representam, respectivamente, os 10 cantores mais ouvidos se considerado todas as músicas do conjunto de dados, e os 10 cantores mais ouvidos se considerado apenas aqueles que tiveram músicas lançadas no ano de 2023.

***Ao analisá-los, evidenciamos que há uma grande variação da composição dos 10 cantores mais ouvidos.***  

A explicção se dá pelo fato de artistas como **The Weekend** possuírem muitas músicas no conjunto analisádo (22 músicas), e que se tiverem seus *streams* somados (aproximadamente 15.000.000.00), os colocam nas primeiras posições no histograma **A1**, emquanto que a outros como **Milley Cyrrus**, primeira colocada no histograma **A2**, que só possui duas músicas totalizando 1.887.370.770, sequer foi ranqueada entre os dez primeiros.

Para exemlificar, trouxemos abaixo, no histograma **A3**, as músicas dos dois artistas:

<div class="grid">
    <div id="ex09" class="card">
        <h4>Todas as músicas dos artistas The Weeknd e Miley Cyrus e suas respectivas qiuantidades de streams.</h4>
        <div style="width: 100%, margin-top: 15px;">
            ${ vl.render(ex09(divWidth+320)) }
        </div>
    </div>
</div>

Sob outra ótica, **Miley Cyrrus**, possui a música **Flowers** lançada em 2023 com 1.316.855.716 em *streams*, enquanto que **The Weekend** não possui música lançada neste ano, deixando de figurar no quadro **A2**, o que reforça a explicação anterior. Veja a distribuição no quadro **A4**:

<div class="grid">
     <div id="ex09" class="card">
        <h4>Músicas As músicas dos artistas The Weeknd e Miley Cyrus e seus respectivos anos de lançamentos. *</h4>
        <div style="width: 100%, margin-top: 15px;">
            ${ vl.render(ex10(divWidth+355)) }
        </div>
        <h6>* Somente músicas que estão listadas no conjunto analisado.</h6>
    </div>
</div>


É possível verificar que o ranqueamento se alterna a media que se fixa outro ano de lançamento da música como parâmetro para a eleição:


<div class="grid grid-cols-2">
    <div id="ex05" class="card">
        <h4>Top 10 maiores cantores com músicas lançadas em 2022.</h4>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex05(divWidth-140)) }
        </div>
    </div>
    <div id="ex06" class="card">
        <h4>Top 10 maiores cantores com músicas lançadas em 2021.</h4>
        <div style="width: 100%; margin-top: 15px;">
            ${ vl.render(ex06(divWidth-195)) }
        </div>
    </div>
</div>
Já no segundo grupo, correspondente às músicas, temos:

<div class="grid grid-cols-2">
    <div id="ex03" class="card">
        <h4>Top 10 músicas mais ouvidas em todo o período analisado.</h4>
        <div style="width: 100%; margin-top: 15px;">
             ${ vl.render(ex03(divWidth-120)) }
        </div>
    </div>
    <div id="ex04" class="card">
        <h4>Top 10 músicas mais ouvidas que foram lançadas em 2023.</h4>
        <div style="width: 100%; margin-top: 15px;">
             ${ vl.render(ex04(divWidth-120)) }
        </div>
    </div>
</div>

Os histogramas acima denominados B1 e B2 representam, respectivamente, as 10 músicas mais ouvidas se considerado todo o período registrado no banco de dados supracitado, e as 10 mais ouvidas se considerado apenas aquelas lançadas no ano de 2023, mesmo ano do banco de dados.

***Ao analisá-los, observamos que houve 80% de variação da composição das 10 músicas mais ouvidas.***

Similarmente ao que ocorre com o ranqueamento dos cantores, é possível verificar que também há alternância a media que se fixa outros anos de lançamento da música como parâmetro:

<div class="grid grid-cols-2">
    <div id="ex07" class="card">
        <h4>Top 10 músicas mais ouvidas que foram lançadas em 2022.</h4>
        <div style="width: 100%; margin-top: 15px;">
             ${ vl.render(ex07(divWidth-120)) }
        </div>
    </div>
    <div id="ex08" class="card">
        <h4>Top 10 músicas mais ouvidas que foram lançadas em 2021.</h4>
        <div style="width: 100%; margin-top: 15px;">
             ${ vl.render(ex08(divWidth-120)) }
        </div>
    </div>
</div>


Dito isto, concluí-se que nos dois caos, dos top 10 cantores e músicas mais ouvidos, ao se comparar todas as músicas e apenas aquelas lançadas no ano de 2023, há uma variação de mais de 79% em ambos os casos.

```js
const divWidth = Generators.width(document.querySelector("#ex01"));

import * as vega from "npm:vega";
import * as vegaLite from "npm:vega-lite";
import * as vegaLiteApi from "npm:vega-lite-api";
import { showCode } from './showCode.js'; 

const vl = vegaLiteApi.register(vega, vegaLite);

const spotify = await FileAttachment("./data/spotify-2023.json").json({typed: true});

showCode(FileAttachment("./total_streams_artists_2021.csv.py"))
const total_streams_artists_2021 = await FileAttachment("./total_streams_artists_2021.csv").csv({typed: true});

showCode(FileAttachment("./total_streams_artists_2022.csv.py"))
const total_streams_artists_2022 = await FileAttachment("./total_streams_artists_2022.csv").csv({typed: true});

showCode(FileAttachment("./total_streams_tracks_2021.csv.py"))
const total_streams_tracks_2021 = await FileAttachment("./total_streams_tracks_2021.csv").csv({typed: true});

showCode(FileAttachment("./total_streams_tracks_2022.csv.py"))
const total_streams_tracks_2022 = await FileAttachment("./total_streams_tracks_2022.csv").csv({typed: true});
function ex01(VdivWidth) {
   return {
        spec: {
            width: VdivWidth,
            padding: 15,   
            data: 
            {
                values: spotify
            },
            title: "A1",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },
            "transform": 
            [
            {
                "aggregate": 
                [{
                    "field": ["streams"],
                    "op": "sum", 
                    "as": "Stream_total",
                }],
                "groupby": ["artist(s)_name"],
            },
            {"filter": "datum.Stream_total >= 5000000000"}
            ],      
            "encoding": 
            {
                "x": 
                {
                    "field": ["artist(s)_name"],
                    "type": "nominal",
                    "aggregate": "artist(s)_name",
                    "sort": 
                    {
                        "field": "Stream_total",
                        "order": "descending"
                    },        
                    "title": "Nome(s) do(s) Cantor(es)", 
                    "axis": {"labelAngle": 45}                                 
                },
                "y": 
                {
                   "field": ["Stream_total"],
                    "type": "quantitative",                    
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex02(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: spotify
            },
            title: "A2",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },
            "transform": 
            [
            {
                "aggregate": 
                [{
                    "field": ["streams"],
                    "op": "sum", 
                    "as": "stream_total",
                }],
                "groupby": ["artist(s)_name","released_year"],
            },
            {"filter": "datum.released_year == 2023 && datum.stream_total >= 510000000"},
            ],      
            "encoding": 
            {
                "color": {"value": "green"},                
                "x": 
                {
                    "field": ["artist(s)_name"],
                    "type": "nominal",
                    "aggregate": "artist(s)_name",
                    "sort": {
                        "field": "stream_total",
                        "order": "descending"
                    },  
                    "title": "Nome(s) do(s) Cantor(es)",
                    "axis": {"labelAngle": 45}          
                },
                "y": 
                {
                   "field": ["stream_total"],
                    "type": "quantitative",
                    "title": "Total de Streams",                        
                }
            }
        }
    }
}

function ex03(VdivWidth) 
{
  return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: spotify
            },
            title: "B1",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },
            "transform": 
            [
            {
                "aggregate": 
                [{
                    "field": ["streams"],
                    "op": "sum", 
                    "as": "Stream_total",
                }],
                "groupby": ["track_name"],
            },
            {
                "filter": "datum.Stream_total >= 2560000000"
            }],      
                   
            "encoding": {
                "color": {"value": "brown"},                
                "x": 
                {
                    "field": ["track_name"],
                    "type": "nominal",
                    "aggregate": "track_name",
                    "sort": {
                        "field": "Stream_total",
                        "order": "descending"
                    },    
                    "title": "Nome da música",
                    "axis": {"labelAngle": 45}        
                },
                "y": 
                {
                   "field": ["Stream_total"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex04(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: spotify
            },
            title: "B2",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },
            "transform": 
            [{
                "aggregate": 
                [{
                    "field": ["streams"],
                    "op": "sum", 
                    "as": "Stream_total",
                }],
                "groupby": ["track_name","released_year"],
            },
            {"filter": "datum.released_year == 2023 && datum.Stream_total >= 430000000"},
         
            ],      
                   
            "encoding": 
            {
                "color": {"value": "gray"},
                "x": 
                {
                   "field": ["track_name"],
                    "type": "nominal",
                    "aggregate": "track_name",
                    "sort": 
                    {
                        "field": "Stream_total",
                        "order": "descending"
                    },  
                    "title": "Nome da música",
                    "axis": {"labelAngle": 45}
                },
                "y": 
                {
                   "field": ["Stream_total"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                },
            }
        }
    }
}

function ex05(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: total_streams_artists_2022
            },
            title: "B2",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },                
            "encoding": 
            {
                "color": {"value": "gray"},
                "x": 
                {
                   "field": ["artist(s)_name"],
                    "type": "nominal",                     
                    "title": "Nome do cantor",
                    "sort": 
                    {
                        "field": "Total Streams (in billions)",
                        "order": "descending"
                    },
                    "axis": {"labelAngle": 45}
                },
                "y": 
                {
                   "field": ["Total Streams (in billions)"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex06(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: total_streams_artists_2021
            },
            title: "B2",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },                
                   
            "encoding": 
            {
                "color": {"value": "red"},
                "x": 
                {
                   "field": ["artist(s)_name"],
                    "type": "nominal",                     
                    "title": "Nome do cantor",
                     "sort": 
                     {
                        "field": "Total Streams (in billions)",
                        "order": "descending"
                    },
                    "axis": {"labelAngle": 45}
                },
                "y": 
                {
                   "field": ["Total Streams (in billions)"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex07(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: total_streams_tracks_2022
            },
            title: "B3",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },                
            "encoding": 
            {
                "color": {"value": "gray"},
                "x": 
                {
                   "field": ["track_name"],
                    "type": "nominal",                     
                    "title": "Nome da música",
                     "sort": 
                    {
                        "field": "Total Streams (in billions)",
                        "order": "descending"
                    },
                    "axis": {"labelAngle": 45}
                },
                "y": 
                {
                   "field": ["Total Streams (in billions)"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex08(VdivWidth) 
{
   return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: total_streams_tracks_2021
            },
            title: "B4",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },                
                   
            "encoding": 
            {
                "color": {"value": "gray"},
                "x": 
                {
                   "field": ["track_name"],
                    "type": "nominal",                     
                    "title": "Nome da música",
                    "sort": 
                    {
                        "field": "Total Streams (in billions)",
                        "order": "descending"
                    },
                    "axis": {"labelAngle": 45}
                },
                "y": 
                {
                   "field": ["Total Streams (in billions)"],
                    "type": "quantitative",
                    "title": "Total de Streams",    
                }
            }
        }
    }
}

function ex09(VdivWidth) 
{
  return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: spotify
            },
            title: "A3",
            "mark": 
            {
                "type": "bar",
                "size": 14,
            },
            "transform": 
            [
            {"filter": {"field": "artist(s)_name", "oneOf": ["Miley Cyrus","The Weeknd"]}},
            ],      
            "encoding": 
            {
                "color": {"value": "brown"},                
                "x": 
                {
                    "field": ["track_name"],
                    "type": "nominal",
                    "aggregate": "track_name",
                    "sort": 
                    {
                        "field": "artist(s)_name",
                        "order": "descending"
                    },    
                    "title": "Nome da música",
                    "axis": {"labelAngle": 45} ,
                },
                "y": 
                {
                    "aggregate": "sum",                                    
                    "field": ["streams"], 
                    "title": "Total de Streams", 
                },
                "xOffset": {"field": "artist(s)_name"},
                "color": {"field": "artist(s)_name"}    
            }
        }
    }
}

function ex10(VdivWidth) 
{
  return {
        spec: {
            width: VdivWidth,
            padding: 15,            
            data: 
            {
                values: spotify
            },
            title: "A4",
            "mark": 
            {
                "type": "point",
                "size": 100,
                "filled": true,
                "line":true,
            },
            "transform": 
            [
            {"filter": {"field": "artist(s)_name", "oneOf": ["Miley Cyrus","The Weeknd"]}},
            ],      
            "encoding": 
            {
                "color": {"value": "brown"},                
                "x": 
                {
                    "field": ["track_name"],
                    "type": "nominal",
                    "aggregate": "track_name",
                    "sort": 
                    {
                        "field": "artist(s)_name",
                        "order": "descending"
                    },    
                    "title": "Nome da música",
                    "axis": {"labelAngle": 45} ,
                },
                "y": 
                {
                    "aggregate": "nominal",                                    
                    "field": ["released_year"], 
                    "title": "Total de Streams", 
                },
                "xOffset": {"field": "artist(s)_name"},
                "color": {"field": "artist(s)_name"},
                "shape": {"field": "artist(s)_name", "type": "nominal"}  
            }
        }
    }
}
```
